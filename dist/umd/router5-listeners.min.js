!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define("router5ListenersPlugin",n):e.router5ListenersPlugin=n()}(this,function(){"use strict";function e(e){return e.split(".").reduce(function(e,n){return e.concat(e.length?e[e.length-1]+"."+n:n)},[])}function n(e,n){return n._meta&&n._meta[e]?Object.keys(n._meta[e]).reduce(function(e,t){return e[t]=n.params[t],e},{}):{}}function t(t,r){function u(){var e=void 0,u=function(){var o=i[e],u=a[e];if(o!==u)return{v:e};var c=n(o,t),f=n(u,r);if(c.length!==f.length)return{v:e};if(0===c.length)return"continue";var s=Object.keys(c).some(function(e){return f[e]!==c[e]});return s?{v:e}:void 0};for(e=0;c>e;e+=1){var f=u();switch(f){case"continue":continue;default:if("object"===("undefined"==typeof f?"undefined":o(f)))return f.v}}return e}var i=r?e(r.name):[],a=e(t.name),c=Math.min(i.length,a.length),f=void 0;r?r&&(t.name!==r.name||t._meta&&r._meta)?f=u():(console.log("[router5.transition-path] Some states are missing metadata, reloading all segments"),f=0):f=0;var s=i.slice(f).reverse(),l=a.slice(f),m=r&&f>0?i[f-1]:"";return{intersection:m,toDeactivate:s,toActivate:l}}function r(){var e=arguments.length<=0||void 0===arguments[0]?i:arguments[0];return function(n){function r(e,n,t){(a[e]||[]).forEach(function(e){return e(n,t)})}function o(n,o,u){var i=t(n,o),a=i.intersection,f=i.toDeactivate,s=(u.reload?"":a,n.name);e.autoCleanUp&&f.forEach(function(e){return c("^"+e)}),r("^"+a,n,o),r("="+s,n,o),r("*",n,o)}function i(){a={}}var a={},c=function(e,t){return t?a[e]&&(a[e]=a[e].filter(function(e){return e!==t})):a[e]=[],n},f=function(e,t,r){var o=e.replace(/^(\*|\^|=)/,"");if(o&&!/^\$/.test(e)){var u=n.rootNode.getSegmentsByName(o);u||console.warn("No route found for "+o+", listener might never be called!")}return a[e]||(a[e]=[]),a[e]=(r?[]:a[e]).concat(t),n};return n.addListener=function(e){return f("*",e)},n.removeListener=function(e){return c("*",e)},n.addNodeListener=function(e,n){return f("^"+e,n,!0)},n.removeNodeListener=function(e,n){return c("^"+e,n)},n.addRouteListener=function(e,n){return f("="+e,n)},n.removeRouteListener=function(e,n){return c("="+e,n)},{name:u,onTransitionSuccess:o,flush:i,listeners:a}}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u="LISTENERS",i={autoCleanUp:!0};return r});