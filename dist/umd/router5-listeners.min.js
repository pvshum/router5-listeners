!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define("router5ListenersPlugin",n):e.router5ListenersPlugin=n()}(this,function(){"use strict";function e(e){return e.split(".").reduce(function(e,n){return e.concat(e.length?e[e.length-1]+"."+n:n)},[])}function n(e,n){return n._meta&&n._meta[e]?Object.keys(n._meta[e]).reduce(function(e,t){return e[t]=n.params[t],e},{}):{}}function t(t,r){function i(){var e=void 0,i=function(){var o=u[e],i=c[e];if(o!==i)return{v:e};var a=n(o,t),f=n(i,r);if(a.length!==f.length)return{v:e};if(0===a.length)return"continue";var s=Object.keys(a).some(function(e){return f[e]!==a[e]});return s?{v:e}:void 0};for(e=0;a>e;e+=1){var f=i();switch(f){case"continue":continue;default:if("object"===("undefined"==typeof f?"undefined":o(f)))return f.v}}return e}var u=r?e(r.name):[],c=e(t.name),a=Math.min(u.length,c.length),f=void 0;r?r&&(t.name!==r.name||t._meta&&r._meta)?f=i():(console.log("[router5.transition-path] Some states are missing metadata, reloading all segments"),f=0):f=0;var s=u.slice(f).reverse(),l=c.slice(f),m=r&&f>0?u[f-1]:"";return{intersection:m,toDeactivate:s,toActivate:l}}function r(e){function n(e,n,t){(u[e]||[]).forEach(function(e){return e(n,t)})}function r(r,o,i){var u=t(r,o),a=u.intersection,f=u.toDeactivate,s=(i.reload?"":a,r.name);e.options.autoCleanUp&&f.forEach(function(e){return c("^"+e)}),n("^"+a,r,o),n("="+s,r,o),n("*",r,o)}function o(){u={}}var u={},c=function(n,t){return t?u[n]&&(u[n]=u[n].filter(function(e){return e!==t})):u[n]=[],e},a=function(n,t,r){var o=n.replace(/^(\*|\^|=)/,"");if(o&&!/^\$/.test(n)){var i=e.rootNode.getSegmentsByName(o);i||console.warn("No route found for "+o+", listener might never be called!")}return u[n]||(u[n]=[]),u[n]=(r?[]:u[n]).concat(t),e};return e.addListener=function(e){return a("*",e)},e.removeListener=function(e){return c("*",e)},e.addNodeListener=function(e,n){return a("^"+e,n,!0)},e.removeNodeListener=function(e,n){return c("^"+e,n)},e.addRouteListener=function(e,n){return a("="+e,n)},e.removeRouteListener=function(e,n){return c("="+e,n)},{name:i,init:init,onTransitionSuccess:r,flush:o,listeners:u}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i="LISTENERS";return r});